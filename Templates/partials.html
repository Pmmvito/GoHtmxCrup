{{define "bloco-login"}}
<div class="card shadow-sm p-4">
    <h5 class="mb-3">Login</h5>
    <div id="login-response"></div>
    <form hx-post="/bloco-login" hx-target="#auth-section" hx-swap="outerHTML">
        <div class="mb-3">
            <label for="login-email" class="form-label">Email</label>
            <input type="email" class="form-control" id="login-email" name="email" autocomplete="email" required>
        </div>
        <div class="mb-3">
            <label for="login-password" class="form-label">Senha</label>
            <input type="password" class="form-control" id="login-password" name="password" autocomplete="current-password" required>
        </div>
        <button type="submit" class="btn btn-success w-100">Entrar</button>
    </form>
</div>
{{end}}

{{define "bloco-register"}}
<div class="card shadow-sm p-4">
    <h5 class="mb-3">Registrar</h5>
    <div id="register-response"></div>
    <form hx-post="/bloco-register" hx-target="#register-response" hx-swap="innerHTML">
        <div class="mb-3">
            <label for="register-name" class="form-label">Nome</label>
            <input type="text" class="form-control" id="register-name" name="name" autocomplete="name" required>
        </div>
        <div class="mb-3">
            <label for="register-email" class="form-label">Email</label>
            <input type="email" class="form-control" id="register-email" name="email" autocomplete="email" required>
        </div>
        <div class="mb-3">
            <label for="register-password" class="form-label">Senha</label>
            <input type="password" class="form-control" id="register-password" name="password" autocomplete="new-password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Registrar</button>
    </form>
</div>
{{end}}
{{define "bloco-formulario"}}
<div id="auth-section">
  <div class="card shadow-sm">
    <div class="card-header">
      <h5 class="mb-0">Novo Formulário</h5>
    </div>
    <div class="card-body">
      <form hx-post="/salvar-form" hx-target="#lista-forms" hx-swap="innerHTML">
        <input type="hidden" name="email" value="{{.Usuario.Email}}">
        <input type="hidden" name="id" value="{{.Form.ID}}">
        <div class="mb-3">
          <label for="nome" class="form-label">Nome do Formulário</label>
          <input type="text" class="form-control" id="nome" name="nome" required>
        </div>
        <div class="mb-3">
          <label for="texto" class="form-label">Conteúdo</label>
          <textarea class="form-control" id="texto" name="texto" rows="4" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary w-100">Salvar Formulário</button>
      </form>

      <hr>
      <h6 class="mb-3">Meus formulários</h6>
      <div id="lista-forms"
           hx-post="/meus-forms"
           hx-vals='{"email":"{{.Usuario.Email}}"}'
           hx-trigger="load">
        <div class="text-muted">Carregando...</div>
      </div>
    </div>
  </div>
</div>
{{end}}

{{define "bloco-lista-forms"}}
{{if .Forms}}
  <ul class="list-group">
    {{range .Forms}}
      <li class="list-group-item d-flex justify-content-between align-items-start">
        <div class="me-3">
          <div class="fw-semibold">{{.Nome}} (ID: {{.ID}})</div>
          <div class="small text-muted">{{.Texto}}</div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-outline-primary"
                  hx-get="/editar-form?id={{.ID}}"
                  hx-vals='{"email":"{{.UserEmail}}"}'
                  hx-target="#auth-section"
                  hx-swap="outerHTML">
            Editar
          </button>
          <button class="btn btn-sm btn-outline-danger"
                  hx-post="/deletar-form"
                  hx-vals='{"id":"{{.ID}}","email":"{{.UserEmail}}"}'
                  hx-target="#lista-forms"
                  hx-swap="innerHTML"
                  hx-confirm="Tem certeza que deseja excluir?">
            Excluir
          </button>
        </div>
      </li>
    {{end}}
  </ul>
{{else}}
  <div class="text-muted">Nenhum formulário encontrado.</div>
{{end}}
{{end}}

{{define "bloco-form-editar"}}
<div id="auth-section">
  <div class="card shadow-sm">
    <div class="card-header">
      <h5 class="mb-0">Editar Formulário</h5>
    </div>
    <div class="card-body">
      <form hx-post="/atualizar-form" hx-target="#auth-section" hx-swap="outerHTML">
        <input type="hidden" name="email" value="{{.Usuario.Email}}">
        <input type="hidden" name="id" value="{{.Form.ID}}">
        <div class="mb-3">
          <label class="form-label">Nome do Formulário</label>
          <input type="text" name="nome" class="form-control" value="{{.Form.Nome}}" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Conteúdo</label>
          <textarea name="texto" class="form-control" rows="4" required>{{.Form.Texto}}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">Salvar</button>
      </form>
    </div>
  </div>
</div>
{{end}}